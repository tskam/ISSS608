---
title: "Hands-on Exercise 7: Handling and Visualising Geospatial Data with R"
subtitle: ""
author: "Dr. Kam Tin Seong<br/>Assoc. Professor of Information Systems"
institute: "School of Computing and Information Systems,<br/>Singapore Management University"
date: "2020-2-15 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    css: [xaringan-themer.css, "css/text.css"]
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      beforeInit: "js/macros.js"
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  fig.retina=3,
  cache = FALSE,
  echo = TRUE,
  message = FALSE, 
  warning = FALSE)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_duo_accent(
  primary_color = "#1381B0",
  secondary_color = "#FF961C",
  inverse_header_color = "#FFFFFF"
)
```

## Content

.large[
- Mapping Geospatial Point Data with R

- Choropleth Mapping with R 
] 

---
## Ex 1:Mapping Geospatial Point Data with R

.pull-left[
In this hands-on exercise, you will learn how to create proportional symbol map by using **tmap** package.

- By the end of this hands-on exercise, you will be able:
    - to import an aspatial data in R by using **readr** pakage,
    - to convert it into simple point feature by using **sf** package, and
    - to create interactive proportional symbol maps by using **tmap** package.
]

---
## Getting Started

.pull-left[
Write a code chunk to check, install and launch  **readr**, **sf** and **tmap** packages of R]

--
.pull-right[
The solution:

```{r echo=FALSE, eval=TRUE}
packages = c('sf', 'tmap', 'biscale', 'tidyverse')
for (p in packages){
  if(!require(p, character.only = T)){
    install.packages(p)
  }
  library(p,character.only = T)
}
```
]

---
## Importing wkt data

.pull-left[

- *Well-known text (WKT)* is a human readable representation for spatial objects like points, lines, or enclosed areas on a map.



]

--
.pull-right[

The solution:

```{r}
schools <- read_sf("data/wkt/Schools.csv", 
                   options = "GEOM_POSSIBLE_NAMES=location")  
```

DIY:

```{r}
pubs <- read_sf("data/wkt/Pubs.csv", 
                   options = "GEOM_POSSIBLE_NAMES=location")
apartments <- read_sf("data/wkt/Apartments.csv", 
                   options = "GEOM_POSSIBLE_NAMES=location")
buildings <- read_sf("data/wkt/Buildings.csv", 
                   options = "GEOM_POSSIBLE_NAMES=location")
employers <- read_sf("data/wkt/Employers.csv", 
                   options = "GEOM_POSSIBLE_NAMES=location")
restaurants <- read_sf("data/wkt/Restaurants.csv", 
                   options = "GEOM_POSSIBLE_NAMES=location")

```



- After importing the data file into R, it is important for us to review the data object.
]

---

```{r}
bldgs <- read_sf("data/wkt/Buildings.csv", 
                   options = "GEOM_POSSIBLE_NAMES=location")  
```

---


```{r}
print(schools)
```

---


```{r}
print(buildings)
```


---
## Ploting a point symbol map

.pull-left[
The code chunk below is used to create an interactive point symbol map.

```{r eval=FALSE}
tmap_mode("view")
tm_shape(buildings)+
tm_polygons(col = "grey60",
           size = 1,
           border.col = "black",
           border.lwd = 1)
```

Things to learn from the code chunk:
- `tmap_mode()` is used to switch the display from static mode (i.e. "plot") to interactive mode (i.e. "view").

- `tm_shape()` is used to create a **tmap-element** that specifies a spatial data object (i.e. point).

- `tm_bubble()` is used to create a **tmap-element** that draws bubbles or small dots. Both colors and sizes of the bubbles can be mapped to data variables.
]]

.pull-right[

```{r echo=FALSE}
tmap_mode("view")
tm_shape(buildings)+
  tm_polygons(col = "grey60",
             size = 1,
             border.col = "black",
             border.lwd = 1)
```
]

---
## Ploting a point symbol map

.pull-left[
The code chunk below is used to create an interactive point symbol map.

```{r eval=FALSE}
tmap_mode("view")
tm_shape(buildings)+
tm_polygons(col = "grey60",
           size = 1,
           border.col = "black",
           border.lwd = 1) +
tm_shape(employers) +
  tm_dots(col = "red")
```
]

.pull-right[

```{r echo=FALSE}
tmap_mode("view")
tm_shape(buildings)+
tm_polygons(col = "grey60",
           size = 1,
           border.col = "black",
           border.lwd = 1) +
tm_shape(employers) +
  tm_dots(col = "red")
```
]

---
## Ploting a composite point symbol map

.pull-left[
The code chunk below is used to create an interactive point symbol map.

```{r eval=FALSE}
tmap_mode("view")
tm_shape(buildings)+
tm_polygons(col = "grey60",
           size = 1,
           border.col = "black",
           border.lwd = 1) +
tm_shape(employers) +
  tm_dots(col = "red") +
tm_shape(apartments) +
  tm_dots(col = "lightblue") +
tm_shape(pubs) +
  tm_dots(col = "green") +
tm_shape(restaurants) +
  tm_dots(col = "blue") +
tm_shape(schools) +
  tm_dots(col = "yellow")
```
]

.pull-right[

```{r echo=FALSE}
tmap_mode("view")
tm_shape(buildings)+
tm_polygons(col = "grey60",
           size = 1,
           border.col = "black",
           border.lwd = 1) +
tm_shape(employers) +
  tm_dots(col = "red") +
tm_shape(apartments) +
  tm_dots(col = "lightblue") +
tm_shape(pubs) +
  tm_dots(col = "green") +
tm_shape(restaurants) +
  tm_dots(col = "blue") +
tm_shape(schools) +
  tm_dots(col = "yellow")
```
]

<<<<<<< HEAD:Hands-on_Ex/Hands-on_Ex07/Hands-on_Ex07-BasicMapping.Rmd
---
### By creating multiple stand-alone maps with `tmap_arrange()`

.large[
The output choropleth maps]

```{r, echo=FALSE, fig.width=15, fig.height=7}
youngmap <- tm_shape(mpsz_agemale2018)+ 
  tm_polygons("YOUNG", 
              style = "quantile", 
              palette = "Blues")

agedmap <- tm_shape(mpsz_agemale2018)+ 
  tm_polygons("AGED", 
              style = "quantile", 
              palette = "Blues")

tmap_arrange(youngmap, 
             agedmap, 
             asp=1, 
             ncol=2)
```


---
## Mappping Spatial Object Meeting a Selection Criterion

.large[
Instead of creating small multiple choropleth map, you can also use selection function to map spatial objects meeting the selection criterion. 

```{r, eval=FALSE}
tm_shape(mpsz_agemale2018[mpsz_agemale2018$REGION_N=="CENTRAL REGION", ]) + #<<
  tm_fill("DEPENDENCY", 
          style = "quantile", 
          palette = "Blues", 
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_layout(legend.outside = TRUE,
            legend.height = 0.45, 
            legend.width = 5.0,
            legend.position = c("right", "bottom"),
            frame = FALSE) +
  tm_borders(alpha = 0.5)
```


---
## Mappping Spatial Object Meeting a Selection Criterion

The output choropleth maps.

```{r, echo=FALSE, fig.width=12, fig.height=6}
tm_shape(mpsz_agemale2018[mpsz_agemale2018$REGION_N=="CENTRAL REGION", ])+
  tm_fill("DEPENDENCY", 
          style = "quantile", 
          palette = "Blues", 
          legend.hist = TRUE, 
          legend.is.portrait = TRUE,
          legend.hist.z = 0.1) +
  tm_layout(legend.outside = TRUE,
            legend.height = 0.45, 
            legend.width = 5.0,
            legend.position = c("right", "bottom"),
            frame = FALSE) +
  tm_borders(alpha = 0.5)
```

=======
>>>>>>> 0289d5edd0906576c9939423d0beef18ebf55060:Hands-on_Ex/Hands-on_Ex07/Hands-on_Ex07.Rmd
```{r echo=FALSE, eval=FALSE}
library(pagedown)
pagedown::chrome_print("Hands-on_Ex07-BasicMapping.html")
```


